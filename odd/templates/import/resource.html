{% macro resource_box(r, current_user) %}

<section id="resource-{{ r.id }}" class="resource thumbnail">
        <header>
            <a class="title" href="{{ url_for('resource.index', id=r.id) }}"><h4>{{ r.title }}</h4></a>
            <p>
            来自：
            {% for tag in r.tags %}
            <a class="tag" href="{{ url_for('tag.index', tag=tag.tag) }}">
                <span class="label label-warning">{{ tag.tag }}</span>
            </a>
            {% endfor %}
            </p>
       </header>
        
       <footer>
           <span class="small">{{ r.create_time }}</span>
            <span class="small pull-right">下载量：{{ r.download_count }}</span>
        </footer>
</section>

{% endmacro %}


{% macro normal_resource(r, current_user) %}
<section id="resource-{{ r.id }}" class="resource">
    <header>
        <h2>{{ r.title }}</h2>
        <hr>
        {% from 'import/tag.html' import tag_editor %}
        {{ tag_editor(r.tags, url_for('resource.tags', id=r.id)) }}
    </header>
    
    <hr>
        
    <pre>{{ r.desc }}</pre>

    <blockquote class="simple-quote">
        <small>
            <a href="{{ url_for('user.index', nickname=r.user.nickname) }}">
                <img class="size-20" src="{{ r.user.photo_url(20) }}" />
                {{ r.user.nickname }}
            </a>
        </small>
    </blockquote>

    <footer>
        &nbsp
        <span class="small pull-right">{{ r.create_time }}</span>
    </footer>
</section>

{% endmacro %}

{% macro download_box(r) %}
<ul class="span3">
    {% for f in r.files() %}
    <li class="small">{{ f.name }}</li>
    {% endfor %}
</ul>

<span class="divider-vertical"></span>

<a class="btn btn-large download" href="{{ r.zip_url() }}" data-url="{{ url_for('resource.download', id=r.id) }}">
    <h2>下载全部</h2>
    <span class="small">zip压缩包</span>
</a>

<script>
    $(function(){
        $('.download').click(function(){
            url = $(this).attr('data-url');
            href = $(this).attr('href');
            $.post(url, function(){
                location.href = href;
            });
            return false;
        });
    });
</script> 
{% endmacro %}
